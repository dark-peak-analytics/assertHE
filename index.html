<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>An R package designed to aid in verification of health economic decision models • assertHE</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="An R package designed to aid in verification of health economic decision models">
<meta name="description" content="An R package designed to help health economic modellers when writing unit tests for their models. The asserts contained in this package include black-box and white-box tests for common errors in health economic models. They are not designed to be exhaustive, but rather to provide a starting point with a set of standard tests to free up modellers to focus on tests specific to the individual model in development or review.">
<meta property="og:description" content="An R package designed to help health economic modellers when writing unit tests for their models. The asserts contained in this package include black-box and white-box tests for common errors in health economic models. They are not designed to be exhaustive, but rather to provide a starting point with a set of standard tests to free up modellers to focus on tests specific to the individual model in development or review.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">assertHE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="asserthe">assertHE<a class="anchor" aria-label="anchor" href="#asserthe"></a>
</h1></div>
<div class="logos">
<p><img src="https://github.com/dark-peak-analytics/darkpeak/blob/main/man/figures/logo_concise.PNG?raw=true" width="120px" align="right"></p>
</div>
<!-- badges: start -->

<!-- badges: end -->
<p>The goal of <code>assertHE</code> is to help modellers build and review health economic models in R. The package provides functions which can be included within models to check that the objects created conform to standard rules (e.g. probabilities between 0 and 1). It also provides functions to review the structure of the model, showing the network of functions color coded by test coverage. Users can click on the nodes to see function and test source code, test coverage and create an AI generated summary of the function.</p>
<p>Rob outlined the package at R-HTA 2024 with a <a href="https://www.youtube.com/watch?v=wr8-w-6QGno" class="external-link">video</a> and <a href="https://github.com/RobertASmith/talks/blob/master/RHTA24-assertHE%20(1).pdf" class="external-link">slides</a> publicly available for those interested in finding out more.</p>
<p>We are continuing to work to improve the package and welcome contributions. To get involved, please see the <a href="https://github.com/dark-peak-analytics/assertHE/blob/main/CONTRIBUTING.md" class="external-link">Contribution guide</a>. For more context about the aims of the wider project please read <a href="https://github.com/dark-peak-analytics/assertHE/wiki/assertHE:-an-R-package-to-improve-quality-assurance-of-health-economic-models" class="external-link">the wiki</a>.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of assertHE from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"dark-peak-analytics/assertHE"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dark-peak-analytics.github.io/assertHE/">assertHE</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="using-the-package">Using the package<a class="anchor" aria-label="anchor" href="#using-the-package"></a>
</h2>
<div class="section level3">
<h3 id="reviewing-model-structure">Reviewing model structure<a class="anchor" aria-label="anchor" href="#reviewing-model-structure"></a>
</h3>
<p>The below code creates a visual representation of the model structure for a given project. The user must provide a path to the project folder, the location of functions (typically “R”) and the location of tests (typically “tests/testthat”).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="reference/visualise_project.html">visualise_project</a></span><span class="op">(</span></span>
<span>  project_path <span class="op">=</span> <span class="st">"path_to_project_directory"</span>,</span>
<span>  foo_path <span class="op">=</span> <span class="st">"R"</span>,</span>
<span>  test_path <span class="op">=</span> <span class="st">"tests/testthat"</span>,</span>
<span>  run_coverage <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p>The result is a visual representation of the model functions. This gives some indication of how to review the model since each function can be checked in isolation and in combination. It may also reveal redundant code.</p>
<p>The below is an example of using the function on the cdx2cea model. The red nodes are the ones without tests, the green nodes are the ones with tests. When hovering over a function we can see more information including where it is defined (file and line number) and where the test (if any) resides. The coverage % of the function is also provided. Tests with coverage &lt;20% are in red, between 20-80% in orange, and above 80% in green. These are arbitrary cut-points, reviewers should assess sufficiency of testing.</p>
<figure><img src="https://github.com/dark-peak-analytics/assertHE/assets/41961614/0d330730-1e0b-40d9-b18b-b2ee14511cb6" alt="Function network for cdx2cea"><figcaption aria-hidden="true">
Function network for cdx2cea
</figcaption></figure><div class="section level4">
<h4 id="using-the-llm-function-summary-tool">Using the LLM function summary tool<a class="anchor" aria-label="anchor" href="#using-the-llm-function-summary-tool"></a>
</h4>
<p>To use the LLM function summary tool follow the guide <a href="https://github.com/dark-peak-analytics/assertHE/wiki/Using-the-LLM-functionality-in-assertHE" class="external-link">here</a>.</p>
</div>
</div>
<div class="section level3">
<h3 id="internal-checks-for-modellers">Internal checks for modellers<a class="anchor" aria-label="anchor" href="#internal-checks-for-modellers"></a>
</h3>
<p>The package has a series of functions to be used <strong>within models</strong> to check that the objects created conform to standard rules (e.g. probabilities between 0 and 1).</p>
<p>The code below shows a basic example which shows you how to use <code>check_trans_prob_array</code> to ensure that the time dependent transition probability array is balanced.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dark-peak-analytics.github.io/assertHE/">assertHE</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a transition probability array</span></span>
<span><span class="va">n_t</span> <span class="op">&lt;-</span> <span class="fl">1000</span> <span class="co"># number of cycles</span></span>
<span><span class="va">v_hs_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"H"</span>, <span class="st">"S"</span>, <span class="st">"D"</span><span class="op">)</span> <span class="co"># health states</span></span>
<span><span class="va">n_hs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">v_hs_names</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create array of transition probabilities</span></span>
<span><span class="va">a_P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span></span>
<span> data <span class="op">=</span> <span class="fl">0</span>,</span>
<span> dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_hs</span>, <span class="va">n_hs</span>, <span class="va">n_t</span><span class="op">)</span>,</span>
<span> dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">v_hs_names</span>, <span class="va">v_hs_names</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n_t</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fill in transition probabilities for main transitions.</span></span>
<span><span class="va">a_P</span><span class="op">[</span><span class="st">"H"</span>, <span class="st">"S"</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.3</span></span>
<span><span class="va">a_P</span><span class="op">[</span><span class="st">"H"</span>, <span class="st">"D"</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.01</span></span>
<span><span class="va">a_P</span><span class="op">[</span><span class="st">"S"</span>, <span class="st">"D"</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span><span class="va">a_P</span><span class="op">[</span><span class="st">"S"</span>, <span class="st">"H"</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span></span>
<span><span class="co"># Fill in the proportion remaining in health state in each slice.</span></span>
<span><span class="co"># This is the remainder after all other transitions are accounted for.</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">x</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_t</span><span class="op">)</span><span class="op">{</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">a_P</span><span class="op">[</span>,,<span class="va">x</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">a_P</span><span class="op">[</span>,,<span class="va">x</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Use the function from the package.</span></span>
<span><span class="co"># This check should return no error, the array is square, numeric, values </span></span>
<span><span class="co"># are between 0 and 1 and all rows sum to 1.</span></span>
<span><span class="co"># Note: stop_if_not = F returns warnings, stop_if_not = T returns errors.</span></span>
<span><span class="fu"><a href="reference/check_trans_prob_array.html">check_trans_prob_array</a></span><span class="op">(</span>a_P <span class="op">=</span> <span class="va">a_P</span>, </span>
<span>                       stop_if_not <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We can introduce an error to see the output</span></span>
<span><span class="co"># In this case, we set the first 10 cycles of transition from H to S to 0.</span></span>
<span><span class="co"># This means that the rows don't sum to 1 for the H row for 1:10 cycle.</span></span>
<span><span class="va">a_P</span><span class="op">[</span><span class="st">"H"</span>, <span class="st">"S"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="fu"><a href="reference/check_trans_prob_array.html">check_trans_prob_array</a></span><span class="op">(</span>a_P <span class="op">=</span> <span class="va">a_P</span>, </span>
<span>                       stop_if_not <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The output looks like this:</span></span>
<span></span>
<span><span class="co"># Warning message:</span></span>
<span><span class="co"># In check_array_rows_balanced(a_P, stop_if_not = stop_if_not) :</span></span>
<span><span class="co">#   Not valid transition probabilities</span></span>
<span><span class="co">#    Transition probabilities not valid from Health States:</span></span>
<span><span class="co"># 1                                           H; at cycle 1</span></span>
<span><span class="co"># 2                                           H; at cycle 2</span></span>
<span><span class="co"># 3                                           H; at cycle 3</span></span>
<span><span class="co"># 4                                           H; at cycle 4</span></span>
<span><span class="co"># 5                                           H; at cycle 5</span></span>
<span><span class="co"># 6                                           H; at cycle 6</span></span>
<span><span class="co"># 7                                           H; at cycle 7</span></span>
<span><span class="co"># 8                                           H; at cycle 8</span></span>
<span><span class="co"># 9                                           H; at cycle 9</span></span>
<span><span class="co"># 10                                         H; at cycle 10</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="using-the-package-to-review-models">Using the package to review models<a class="anchor" aria-label="anchor" href="#using-the-package-to-review-models"></a>
</h2>
<p>Please get in contact if you would like to use the package to help review a model in R.</p>
<p>The following models have been visualized using the package, as test cases:</p>
<ul>
<li>
<a href="https://github.com/nice-digital/NICE-model-repo" class="external-link">NICE RCC Model</a><br>
</li>
<li>
<a href="https://github.com/dark-peak-analytics/sicksickerPack" class="external-link">sicksickerPack</a> teaching model contained in a package.<br>
</li>
<li>
<a href="https://github.com/feralaes/cdx2cea" class="external-link">cdx2cea</a> as described in <a href="https://www.sciencedirect.com/science/article/pii/S1098301521017472" class="external-link">Alarid-Escudero et al. 2022</a><br>
</li>
<li>
<a href="https://github.com/Bogdasayen/DOACs-AF-Economic-model" class="external-link">DOACs-AF-Economic-model</a> developed by Bristol University<br>
</li>
<li>The CGD AMR Cost model - in press.<br>
</li>
<li>
<a href="https://github.com/DanPollardSheff/Embedding-Economic-Analysis" class="external-link">Embedding Economics Analysis</a> Diabetes Microsimulation model described in (in press).<br>
</li>
<li>Several internal models at Dark Peak Analytics.<br>
</li>
<li>Several internal models at Maple Health.<br>
</li>
<li>The National Institute for Health and Care Excellence (NICE) have built the <code>assertHE</code> visualiser into their template for model reviews.</li>
</ul>
<p>Health Economics Modelling Packages:<br>
- <a href="https://cran.rstudio.com/web/packages/voi/index.html" class="external-link">voi R package</a> reviewed by GSK team.</p>
</div>
<div class="section level2">
<h2 id="sharing-interactive-model-networks">Sharing interactive model networks<a class="anchor" aria-label="anchor" href="#sharing-interactive-model-networks"></a>
</h2>
<p>Once the model has been generated, it is possible to share the HTML for the interactive network. In the visualisation tab click the downward arrow on the ‘export’ button and then click ‘save as web page’.</p>
<p>The visualisation for the HTML file may take a while to load for large networks. However, all the funtionality from the HTML version (not the shiny version with the links) should be there.</p>
</div>
<div class="section level2">
<h2 id="get-in-contact">Get in contact<a class="anchor" aria-label="anchor" href="#get-in-contact"></a>
</h2>
<p>To get in contact about this project or other collaborations please feel free to message me on any of the below.</p>
<p><a href="https://www.linkedin.com/in/robert-smith-53b28438" class="external-link">Dr. Robert Smith</a></p>
<p>Contact: <a href="mailto:rsmith@darkpeakanalytics.com" class="email">rsmith@darkpeakanalytics.com</a></p>
<p>Website: <a href="https://www.darkpeakanalytics.com" class="external-link">Dark Peak Analytics</a></p>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing assertHE</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Robert Smith <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-0245-3217" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/dark-peak-analytics/assertHE/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/dark-peak-analytics/assertHE/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robert Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
